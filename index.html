<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Textbausteine mit Platzhaltern</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    label { display:block; margin-top: 1em; }
    textarea { width: 100%; height: 150px; margin-top: 1em; }
    .placeholder { color: red; font-weight: bold; }
    #titleBox, #preview { border: 1px solid #aaa; padding: 1em; margin-top: 1em; white-space: pre-wrap; }
    button { margin-top: 0.5em; }
  </style>
</head>
<body>
  <h1>Textbausteine ausfüllen</h1>

  <label for="templateSelect">Vorlage auswählen:</label>
  <select id="templateSelect"></select>

  <form id="inputForm"></form>
  <button type="button" onclick="fillTemplate()">Vorlage ausfüllen</button>

  <h2>Titel</h2>
  <div id="titleBox"></div>
  <button onclick="copyTitle()">Titel kopieren</button>

  <h2>Vorschau</h2>
  <div id="preview"></div>
  <button onclick="copyText()">Text kopieren</button>

  <script>
    const templates = [
      { name: "Gruß", text: "Hallo {{name}},\n\nich hoffe es geht dir gut!\n\nViele Grüße,\n{{sender}}" },
      { name: "Rechnung", text: "Sehr geehrte/r {{name}},\n\nHiermit erhalten Sie die Rechnung über {{betrag}} Euro.\n\nMit freundlichen Grüßen\n{{firma}}" },
      { name: "Jobangebot", text: "Hallo {{name}},\n\nwir freuen uns, Ihnen die Stelle als {{position}} anzubieten.\n\nBeste Grüße,\n{{firma}}" }
    ];

    const select = document.getElementById('templateSelect');
    const form = document.getElementById('inputForm');
    const preview = document.getElementById('preview');
    const titleBox = document.getElementById('titleBox');

    // Hilfsfunktion für Regex-Escape
    function escapeRegex(str) {
      return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // Dropdown füllen
    templates.forEach((t,i)=>{
      let opt = document.createElement('option');
      opt.value = i; opt.textContent = t.name;
      select.appendChild(opt);
    });

    // Formularfelder für ausgewählte Vorlage generieren
    function buildFormForTemplate(t){
      form.innerHTML = '';
      const regex = /{{\s*([a-zA-Z0-9_äöüÄÖÜß]+)\s*}}/g;
      let m, found = new Set();
      while((m = regex.exec(t.text))) found.add(m[1]);
      found.forEach(k=>{
        let label = document.createElement('label');
        label.textContent = k+":";
        let input = document.createElement('input');
        input.name = k;
        form.appendChild(label);
        form.appendChild(input);
      });
    }

    select.addEventListener('change',()=>{
      buildFormForTemplate(templates[select.value]);
      preview.innerHTML = '';
      titleBox.textContent = '';
    });

    // Vorlage ausfüllen
    function fillTemplate(){
      const t = templates[select.value];
      let out = t.text;
      const data = {};
      [...form.elements].forEach(el=>{
        if(el.name) data[el.name]=el.value;
      });
      for(const [key,val] of Object.entries(data)){
        const re = new RegExp('{{\\s*' + escapeRegex(key) + '\\s*}}','g');
        out = out.replace(re, val||'');
      }
      // Vorschau anzeigen
      preview.innerHTML = out.replace(/{{\s*([a-zA-Z0-9_äöüÄÖÜß]+)\s*}}/g,(m,k)=>`<span class="placeholder">${k} (fehlt)</span>`);

      // Titel erzeugen: Basis = Vorlagenname + evtl. Name einsetzen
      let title = t.name;
      if (data.name) {
        title += " für " + data.name;
      }
      titleBox.textContent = title;
    }

    function copyText(){
      navigator.clipboard.writeText(preview.innerText);
      alert('Text in Zwischenablage kopiert!');
    }

    function copyTitle(){
      navigator.clipboard.writeText(titleBox.innerText);
      alert('Titel in Zwischenablage kopiert!');
    }

    // Beim Laden erste Vorlage auswählen
    buildFormForTemplate(templates[0]);
  </script>
</body>
</html>
