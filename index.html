<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Vorlagen-Ausfüller — Dropdown + Formular</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:24px;background:#f7f9fc;color:#111}
    .container{max-width:900px;margin:0 auto;background:white;padding:18px;border-radius:8px;box-shadow:0 6px 18px rgba(10,20,40,0.06)}
    label{display:block;margin-top:10px;font-weight:600}
    select, input, textarea, button{width:100%;padding:10px;border-radius:6px;border:1px solid #d1d7df;font-size:15px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .controls{display:flex;gap:8px;margin-top:12px}
    .preview{white-space:pre-wrap;padding:12px;border-radius:6px;border:1px dashed #cbd5e1;background:#fbfdff;margin-top:12px}
    .placeholder{background:linear-gradient(90deg,rgba(255,230,180,0.6),rgba(255,240,200,0.4));padding:2px 6px;border-radius:4px}
    .small{font-size:13px;color:#556}
    .buttons{display:flex;gap:8px;margin-top:10px}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <h2>Vorlagen-Ausfüller (Dropdown + Formular)</h2>
    <p class="small">Wähle eine Vorlage aus der Liste. Die Formularfelder werden automatisch aus den Platzhaltern (z. B. <code>{{name}}</code>) erzeugt. Fülle sie aus und klicke auf „Vorlage ausfüllen“.</p>

    <label for="templateSelect">Vorlage auswählen</label>
    <select id="templateSelect"></select>

    <div id="formArea"></div>

    <div class="controls">
      <div style="flex:1">
        <label for="extraNote">Zusatztext (optional)</label>
        <input id="extraNote" placeholder="Zusätzlichen Text eingeben...">
      </div>
      <div style="width:160px">
        <label>&nbsp;</label>
        <button id="fillBtn">Vorlage ausfüllen</button>
      </div>
    </div>

    <div class="buttons">
      <button id="copyBtn">In Zwischenablage kopieren</button>
      <button id="resetBtn">Formular zurücksetzen</button>
    </div>

    <h3 style="margin-top:18px">Vorschau</h3>
    <div id="preview" class="preview">(Hier erscheint der ausgefüllte Text)</div>

    <details style="margin-top:14px">
      <summary>Vorlagenliste</summary>
      <pre id="templateList" class="small"></pre>
    </details>

    <p class="small" style="margin-top:10px">Hinweis: Neue Vorlagen können unten im JavaScript im <code>templates</code>-Array hinzugefügt werden.</p>
  </div>

  <script>
  // === Vorlagen hier anpassen oder erweitern ===
  const templates = [
    {
      id: 'gruss',
      title: 'Einfacher Gruß',
      text: 'Hallo {{name}},\n\nich hoffe, es geht dir gut. Wir treffen uns am {{datum}} um {{uhrzeit}} im {{ort}}. Bitte bring {{gegenstand}} mit.\n\nBeste Grüße,\n{{absender}}'
    },
    {
      id: 'rechnung',
      title: 'Rechnungsnotiz',
      text: 'Rechnung für {{kunde}}\nZeitraum: {{von}} bis {{bis}}\nBetrag: {{betrag}} EUR\nBeschreibung: {{beschreibung}}\n\nBitte überweisen an: {{bank}} (IBAN: {{iban}})\nMit freundlichen Grüßen,\n{{absender}}'
    },
    {
      id: 'jobangebot',
      title: 'Jobangebot (kurz)',
      text: 'Sehr geehrte/r {{bewerber}},\n\nwir freuen uns, Ihnen die Stelle als {{position}} bei {{firma}} anzubieten. Startdatum: {{start}}. Gehalt: {{gehalt}} EUR pro Jahr.\n\nBitte bestätigen Sie bis zum {{frist}}.\n\nMit freundlichen Grüßen,\n{{hr}}'
    }
  ];
  // =============================================

  const sel = document.getElementById('templateSelect');
  const formArea = document.getElementById('formArea');
  const preview = document.getElementById('preview');
  const templateList = document.getElementById('templateList');

  // Hilfsfunktion zum Escapen für RegExp
  function escapeRegex(str) {
    return str.replace(/[.*+?^${}()|[\\]\\]/g, '\\$&');
  }

  templates.forEach(t => {
    const opt = document.createElement('option');
    opt.value = t.id; opt.textContent = t.title;
    sel.appendChild(opt);
  });

  templateList.textContent = templates.map(t => `${t.title} (id: ${t.id})\n---\n${t.text}\n`).join('\n');

  function extractPlaceholders(text){
    const re = /{{\s*([a-zA-Z0-9_äöüÄÖÜß]+)\s*}}/g;
    const set = new Set();
    let m;
    while((m=re.exec(text))!==null) set.add(m[1]);
    return Array.from(set);
  }

  function buildFormForTemplate(t){
    formArea.innerHTML = '';
    const keys = extractPlaceholders(t.text);
    if(keys.length===0){
      formArea.innerHTML = '<p class="small">Diese Vorlage hat keine Platzhalter.</p>';
      return;
    }
    const grid = document.createElement('div'); grid.className='row';
    keys.forEach(k => {
      const wrapper = document.createElement('div');
      const label = document.createElement('label'); label.textContent = k;
      const input = document.createElement('input'); input.dataset.key = k; input.placeholder = `${k} eingeben`;
      wrapper.appendChild(label); wrapper.appendChild(input);
      grid.appendChild(wrapper);
    });
    formArea.appendChild(grid);
  }

  function getCurrentTemplate(){
    const id = sel.value;
    return templates.find(t=>t.id===id) || templates[0];
  }

  buildFormForTemplate(getCurrentTemplate());

  sel.addEventListener('change', ()=>{
    buildFormForTemplate(getCurrentTemplate());
    preview.textContent = '(Hier erscheint der ausgefüllte Text)';
  });

  document.getElementById('fillBtn').addEventListener('click', ()=>{
    const t = getCurrentTemplate();
    let out = t.text;
    const inputs = formArea.querySelectorAll('input[data-key]');
    inputs.forEach(inp => {
      const key = inp.dataset.key;
      const val = inp.value || `«${key}»`;
      const re = new RegExp('{{\\s*' + escapeRegex(key) + '\\s*}}','g');
      out = out.replace(re, val);
    });
    const extra = document.getElementById('extraNote').value.trim();
    if(extra) out += '\n\n' + extra;

    const remaining = extractPlaceholders(out);
    if(remaining.length>0){
      preview.innerHTML = out.replace(/{{\s*([a-zA-Z0-9_äöüÄÖÜß]+)\s*}}/g,(m,k)=>`<span class="placeholder">${k} (fehlt)</span>`);
    } else {
      const esc = out.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      preview.innerHTML = esc;
    }
  });

  document.getElementById('copyBtn').addEventListener('click', async ()=>{
    const text = preview.textContent || preview.innerText || '';
    try{
      await navigator.clipboard.writeText(text);
      alert('In Zwischenablage kopiert');
    }catch(e){
      alert('Kopieren fehlgeschlagen — möglicherweise blockiert dein Browser den Zugriff.');
    }
  });

  document.getElementById('resetBtn').addEventListener('click', ()=>{
    formArea.querySelectorAll('input[data-key]').forEach(i=>i.value='');
    document.getElementById('extraNote').value='';
    preview.textContent='(Hier erscheint der ausgefüllte Text)';
  });

  document.addEventListener('keydown', (e)=>{
    if(e.ctrlKey && e.key==='Enter') document.getElementById('fillBtn').click();
  });
  </script>
</body>
</html>
